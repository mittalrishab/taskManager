<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Focus - Smart Task Planner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #8B5CF6;
            --primary-light: #A78BFA;
            --primary-dark: #7C3AED;
            --secondary: #10B981;
            --danger: #EF4444;
            --warning: #F59E0B;
            --light-bg: #F8FAFC;
            --card-bg: #FFFFFF;
            --text: #1E293B;
            --text-light: #64748B;
            --border: #E2E8F0;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--light-bg);
            color: var(--text);
            transition: background-color 0.3s, color 0.3s;
            overflow-x: hidden;
        }

        .dark-mode {
            --light-bg: #0F172A;
            --card-bg: #1E293B;
            --text: #F1F5F9;
            --text-light: #94A3B8;
            --border: #334155;
        }

        .task-item {
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }

        .task-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .task-item.high-priority {
            border-left-color: var(--danger);
        }

        .task-item.medium-priority {
            border-left-color: var(--warning);
        }

        .task-item.low-priority {
            border-left-color: var(--secondary);
        }

        .completed-task {
            opacity: 0.7;
            background-color: #F8FAFC;
        }

        .dark-mode .completed-task {
            background-color: #1E293B;
        }

        .category-tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .stats-card {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            border-radius: 12px;
            padding: 1rem;
        }

        .progress-ring {
            transform: rotate(-90deg);
        }

        .progress-ring-circle {
            transition: stroke-dashoffset 0.3s;
        }

        .floating-action-btn {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 20px rgba(139, 92, 246, 0.4);
            z-index: 50;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .floating-action-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(139, 92, 246, 0.6);
        }

        @media (max-width: 768px) {
            .floating-action-btn {
                bottom: 1.5rem;
                right: 1.5rem;
                width: 56px;
                height: 56px;
            }
        }

        /* Custom scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: var(--primary-light);
            border-radius: 10px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: var(--border);
            border-radius: 10px;
        }

        /* Animation for new tasks */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .task-item {
            animation: slideIn 0.3s ease;
        }

        /* Focus mode */
        .focus-mode .non-essential {
            opacity: 0.3;
            pointer-events: none;
        }

        .focus-mode .focused-task {
            transform: scale(1.02);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            z-index: 10;
        }

        /* Modal styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            padding: 1rem;
        }

        .modal-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1.5rem;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            transform: translateY(20px);
            transition: transform 0.3s ease;
        }

        .modal-overlay.active .modal-content {
            transform: translateY(0);
        }

        /* Drag and drop styles */
        .task-item.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }

        .task-item.drag-over {
            border-top: 2px solid var(--primary);
        }

        /* Toast notifications */
        .toast {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--card-bg);
            color: var(--text);
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            transition: transform 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
        }

        .toast.success {
            border-left: 4px solid var(--secondary);
        }

        .toast.error {
            border-left: 4px solid var(--danger);
        }

        .toast.info {
            border-left: 4px solid var(--primary);
        }

        /* Pomodoro timer styles */
        .pomodoro-timer {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .timer-display {
            font-size: 3rem;
            font-weight: bold;
            text-align: center;
            margin: 1rem 0;
            font-variant-numeric: tabular-nums;
        }

        .timer-controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
        }

        .timer-progress {
            height: 6px;
            background: var(--border);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 1rem;
        }

        .timer-progress-bar {
            height: 100%;
            background: var(--primary);
            width: 0%;
            transition: width 1s linear;
        }

        /* Quick actions */
        .quick-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .quick-action-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .quick-action-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Mobile menu */
        .mobile-menu {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--card-bg);
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-around;
            padding: 0.75rem;
            z-index: 40;
            transform: translateY(100%);
            transition: transform 0.3s ease;
        }

        .mobile-menu.active {
            transform: translateY(0);
        }

        .mobile-menu-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 0.75rem;
            color: var(--text-light);
            transition: color 0.2s;
        }

        .mobile-menu-item.active {
            color: var(--primary);
        }

        .mobile-menu-item i {
            font-size: 1.25rem;
            margin-bottom: 0.25rem;
        }

        /* Swipe actions for tasks */
        .task-swipe-actions {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            display: flex;
            width: 0;
            overflow: hidden;
            transition: width 0.3s ease;
            border-radius: 0.5rem;
        }

        .task-item.swiped .task-swipe-actions {
            width: 120px;
        }

        .swipe-action {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 60px;
            color: white;
            transition: all 0.2s;
        }

        .swipe-action.complete {
            background: var(--secondary);
        }

        .swipe-action.delete {
            background: var(--danger);
        }

        /* Kanban board view */
        .kanban-column {
            min-height: 400px;
            background: var(--card-bg);
            border-radius: 0.5rem;
            padding: 1rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .kanban-column h3 {
            font-weight: 600;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border);
        }

        /* Habit tracker */
        .habit-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
        }

        .habit-day {
            aspect-ratio: 1;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .habit-day.completed {
            background: var(--secondary);
            color: white;
        }

        .habit-day.missed {
            background: var(--danger);
            color: white;
        }

        /* Focus session stats */
        .focus-session {
            background: var(--card-bg);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        /* Time blocking */
        .time-block {
            border-radius: 0.5rem;
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            background: var(--primary-light);
            color: white;
            font-size: 0.875rem;
        }

        /* Smart suggestions */
        .suggestion-card {
            background: var(--card-bg);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border-left: 4px solid var(--primary);
        }

        /* Improved mobile responsiveness */
        @media (max-width: 640px) {
            .task-input-grid {
                grid-template-columns: 1fr;
            }
            
            .quick-actions {
                justify-content: space-between;
            }
            
            .quick-action-btn {
                flex: 1;
                justify-content: center;
                min-width: 0;
            }
            
            .modal-content {
                padding: 1rem;
                margin: 1rem;
            }
            
            .timer-display {
                font-size: 2.5rem;
            }
            
            .stats-card {
                padding: 0.75rem;
            }
        }

        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                order: 2;
            }
            
            .task-section {
                order: 1;
            }
            
            .header-actions {
                flex-wrap: wrap;
                gap: 0.5rem;
            }
        }

        /* UI enhancements */
        .glass-effect {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.7);
        }

        .dark-mode .glass-effect {
            background: rgba(30, 41, 59, 0.7);
        }

        .pulse-animation {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(139, 92, 246, 0.4);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(139, 92, 246, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(139, 92, 246, 0);
            }
        }

        .shake-animation {
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        .bounce-in {
            animation: bounceIn 0.6s;
        }

        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); opacity: 0.9; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Focus session visualization */
        .focus-visualization {
            height: 4px;
            border-radius: 2px;
            background: var(--border);
            margin: 0.5rem 0;
            overflow: hidden;
        }

        .focus-block {
            height: 100%;
            float: left;
        }

        /* Task estimation */
        .estimation-bar {
            height: 4px;
            border-radius: 2px;
            background: var(--border);
            margin-top: 0.5rem;
            overflow: hidden;
        }

        .estimation-progress {
            height: 100%;
            background: var(--primary);
            transition: width 0.3s;
        }

        /* Smart suggestions */
        .suggestion-item {
            padding: 0.75rem;
            border-radius: 0.5rem;
            background: var(--card-bg);
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }

        .suggestion-item:hover {
            transform: translateX(5px);
            border-left-color: var(--primary);
        }

        /* New improvements */
        .task-item.overdue {
            border-left-color: var(--danger);
            background-color: rgba(239, 68, 68, 0.05);
        }

        .dark-mode .task-item.overdue {
            background-color: rgba(239, 68, 68, 0.1);
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--danger);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
        }

        .task-input:focus {
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2);
        }

        .priority-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
        }

        .priority-high {
            background-color: var(--danger);
        }

        .priority-medium {
            background-color: var(--warning);
        }

        .priority-low {
            background-color: var(--secondary);
        }

        .streak-counter {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: bold;
        }

        .task-dragging {
            opacity: 0.6;
            transform: rotate(5deg);
        }

        .drop-zone {
            border: 2px dashed var(--primary);
            background-color: rgba(139, 92, 246, 0.05);
        }

        .empty-state {
            text-align: center;
            padding: 2rem;
            color: var(--text-light);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .loading-spinner {
            border: 3px solid rgba(139, 92, 246, 0.3);
            border-radius: 50%;
            border-top: 3px solid var(--primary);
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .context-menu {
            position: absolute;
            background: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            padding: 0.5rem 0;
            min-width: 150px;
            display: none;
        }

        .context-menu.active {
            display: block;
        }

        .context-menu-item {
            padding: 0.5rem 1rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .context-menu-item:hover {
            background-color: rgba(139, 92, 246, 0.1);
        }

        .achievement-badge {
            display: inline-flex;
            align-items: center;
            background: var(--card-bg);
            border-radius: 20px;
            padding: 0.25rem 0.75rem;
            margin: 0.25rem;
            font-size: 0.75rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .achievement-badge i {
            margin-right: 0.25rem;
            color: var(--warning);
        }

        /* New Features */
        
        /* Calendar View */
        .calendar-view {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }
        
        .calendar-day {
            aspect-ratio: 1;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            padding: 4px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid var(--border);
        }
        
        .calendar-day:hover {
            background-color: rgba(139, 92, 246, 0.1);
        }
        
        .calendar-day.active {
            background-color: var(--primary);
            color: white;
        }
        
        .calendar-day.has-tasks::after {
            content: '';
            width: 4px;
            height: 4px;
            background-color: var(--primary);
            border-radius: 50%;
            margin: 2px auto 0;
        }
        
        .calendar-day.active.has-tasks::after {
            background-color: white;
        }
        
        /* Time Tracking */
        .time-tracker {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .time-tracker-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--primary);
            color: white;
            cursor: pointer;
        }
        
        .time-tracker-display {
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        /* Collaboration */
        .collaborator {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--primary-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            color: white;
            margin-right: -8px;
            border: 2px solid var(--card-bg);
        }
        
        .collaborators-list {
            display: flex;
            align-items: center;
        }
        
        /* Task Templates */
        .template-card {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid var(--border);
        }
        
        .template-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        /* Advanced Analytics */
        .analytics-chart {
            height: 200px;
            background: var(--card-bg);
            border-radius: 8px;
            margin-bottom: 16px;
            display: flex;
            align-items: flex-end;
            padding: 16px;
            gap: 8px;
        }
        
        .chart-bar {
            flex: 1;
            background: var(--primary);
            border-radius: 4px 4px 0 0;
            transition: height 0.5s;
        }
        
        /* Smart Notifications */
        .notification-item {
            padding: 12px;
            border-radius: 8px;
            background: var(--card-bg);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
            border-left: 4px solid var(--primary);
        }
        
        .notification-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--primary-light);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }
        
        /* Mobile Responsiveness Improvements */
        @media (max-width: 640px) {
            .header-actions {
                gap: 8px;
            }
            
            .header-actions button {
                padding: 6px;
            }
            
            .stats-card {
                padding: 12px;
            }
            
            .task-input-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .quick-actions {
                gap: 8px;
            }
            
            .quick-action-btn {
                flex: 1 0 calc(50% - 8px);
                justify-content: center;
                min-width: 0;
            }
            
            .modal-content {
                margin: 16px;
                padding: 16px;
            }
            
            .timer-display {
                font-size: 2rem;
            }
            
            .timer-controls {
                gap: 8px;
            }
            
            .timer-controls button {
                padding: 8px 12px;
            }
            
            .calendar-view {
                gap: 2px;
            }
            
            .calendar-day {
                font-size: 0.75rem;
                padding: 2px;
            }
            
            .collaborators-list {
                flex-wrap: wrap;
                gap: 4px;
            }
            
            .collaborator {
                margin-right: 0;
            }
        }
        
        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                order: 2;
            }
            
            .task-section {
                order: 1;
            }
            
            .kanban-column {
                min-height: 200px;
            }
        }
        
        @media (max-width: 1024px) {
            .kanban-column {
                min-height: 300px;
            }
        }
        
        /* Touch Improvements */
        .touch-friendly {
            min-height: 44px;
            min-width: 44px;
        }
        
        .touch-friendly-btn {
            padding: 12px 16px;
        }
        
        /* Enhanced Swipe Actions */
        .task-item {
            touch-action: pan-y;
        }
        
        /* Improved Focus Mode for Mobile */
        .focus-mode-mobile {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--light-bg);
            z-index: 1000;
            padding: 16px;
            overflow-y: auto;
        }
        
        .focus-mode-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        /* Enhanced Empty States */
        .empty-state {
            padding: 40px 20px;
            text-align: center;
            color: var(--text-light);
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 16px;
            opacity: 0.5;
        }
        
        .empty-state p {
            margin-bottom: 8px;
        }
        
        .empty-state button {
            margin-top: 16px;
        }
        
        /* Improved Loading States */
        .skeleton {
            background: linear-gradient(90deg, var(--border) 25%, rgba(255,255,255,0.5) 50%, var(--border) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: 4px;
        }
        
        @keyframes loading {
            0% {
                background-position: 200% 0;
            }
            100% {
                background-position: -200% 0;
            }
        }
        
        /* New Feature: Calendar Integration */
        .calendar-integration {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }
        
        .calendar-weekday {
            text-align: center;
            font-size: 0.75rem;
            color: var(--text-light);
            padding: 4px;
        }
        
        /* New Feature: Task Templates */
        .templates-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 16px;
        }
        
        .template-card {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid var(--border);
        }
        
        .template-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .template-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: var(--primary-light);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            margin-bottom: 12px;
        }
        
        /* New Feature: Collaboration */
        .collaboration-section {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }
        
        .collaborator-card {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: 8px;
            background: var(--light-bg);
            margin-bottom: 8px;
        }
        
        .collaborator-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        /* New Feature: Advanced Analytics */
        .analytics-section {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }
        
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
        }
        
        .analytics-card {
            background: var(--light-bg);
            border-radius: 8px;
            padding: 16px;
            text-align: center;
        }
        
        .analytics-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .analytics-label {
            font-size: 0.875rem;
            color: var(--text-light);
        }
        
        /* New Feature: Time Tracking */
        .time-tracking-section {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }
        
        .time-entry {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-radius: 8px;
            background: var(--light-bg);
            margin-bottom: 8px;
        }
        
        .time-duration {
            font-weight: bold;
        }
        
        /* New Feature: Smart Notifications */
        .notifications-section {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }
        
        .notification-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: 8px;
            background: var(--light-bg);
            margin-bottom: 8px;
        }
        
        .notification-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--primary-light);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }
        
        .notification-content {
            flex: 1;
        }
        
        .notification-time {
            font-size: 0.75rem;
            color: var(--text-light);
        }
    </style>
</head>
<body class="transition-colors duration-300 pb-16 md:pb-0">
    <div id="app" class="min-h-screen p-4 md:p-6">
        <!-- Header -->
        <header class="max-w-6xl mx-auto mb-6 md:mb-8">
            <div class="flex justify-between items-center">
                <div class="flex items-center">
                    <div class="w-10 h-10 rounded-full bg-gradient-to-r from-purple-500 to-indigo-600 flex items-center justify-center mr-3">
                        <i class="fas fa-tasks text-white"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold">Daily Focus</h1>
                        <p class="text-sm text-gray-500 hidden md:block">Smart Task Planner</p>
                    </div>
                </div>
                <div class="flex items-center space-x-2 md:space-x-4 header-actions">
                    <button id="viewToggle" class="p-2 rounded-full bg-gray-200 dark:bg-gray-700 transition-colors relative touch-friendly" title="Toggle View">
                        <i class="fas fa-columns text-gray-700 dark:text-gray-300"></i>
                    </button>
                    <button id="themeToggle" class="p-2 rounded-full bg-gray-200 dark:bg-gray-700 transition-colors touch-friendly" title="Toggle Theme">
                        <i class="fas fa-moon text-gray-700 dark:text-yellow-400"></i>
                    </button>
                    <button id="focusModeToggle" class="px-3 py-1.5 bg-purple-100 text-purple-700 rounded-full text-sm font-medium hover:bg-purple-200 transition-colors touch-friendly-btn">
                        <i class="fas fa-bullseye mr-1"></i> <span class="hidden md:inline">Focus</span>
                    </button>
                    <button id="calendarToggle" class="p-2 rounded-full bg-gray-200 dark:bg-gray-700 transition-colors touch-friendly" title="Calendar View">
                        <i class="fas fa-calendar text-gray-700 dark:text-gray-300"></i>
                    </button>
                    <button id="settingsToggle" class="p-2 rounded-full bg-gray-200 dark:bg-gray-700 transition-colors relative touch-friendly" title="Settings">
                        <i class="fas fa-cog text-gray-700 dark:text-gray-300"></i>
                        <span id="settingsNotification" class="notification-badge hidden"></span>
                    </button>
                </div>
            </div>
        </header>

        <div class="max-w-6xl mx-auto">
            <!-- Stats and Date Navigation -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6 mb-6 md:mb-8">
                <!-- Stats Card -->
                <div class="stats-card md:col-span-2">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-purple-100">Today's Progress</p>
                            <h2 class="text-2xl font-bold mt-1" id="progressText">0/0 Tasks</h2>
                            <p class="text-purple-100 text-sm mt-2" id="motivationalQuote">"The secret of getting ahead is getting started."</p>
                        </div>
                        <div class="relative w-16 h-16">
                            <svg class="progress-ring w-16 h-16" width="64" height="64">
                                <circle class="progress-ring-circle" stroke="rgba(255,255,255,0.3)" stroke-width="4" fill="transparent" r="28" cx="32" cy="32"/>
                                <circle class="progress-ring-circle" stroke="white" stroke-width="4" fill="transparent" r="28" cx="32" cy="32" id="progressCircle" stroke-dasharray="175.93" stroke-dashoffset="175.93"/>
                            </svg>
                            <div class="absolute inset-0 flex items-center justify-center text-white font-bold text-sm">
                                <span id="progressPercent">0%</span>
                            </div>
                        </div>
                    </div>
                    <!-- Focus session visualization -->
                    <div class="mt-3">
                        <div class="flex justify-between text-purple-100 text-xs">
                            <span>Focus Sessions Today:</span>
                            <span id="focusSessionsCount">0</span>
                        </div>
                        <div class="focus-visualization mt-1" id="focusVisualization">
                            <!-- Focus blocks will be added here dynamically -->
                        </div>
                    </div>
                </div>

                <!-- Date Navigation -->
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 flex flex-col justify-center">
                    <div class="flex justify-between items-center">
                        <button id="prevDay" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors touch-friendly">
                            <i class="fas fa-chevron-left text-gray-600 dark:text-gray-300"></i>
                        </button>
                        <div class="text-center">
                            <p id="dayOfWeek" class="text-lg font-semibold text-gray-800 dark:text-white">Today</p>
                            <p id="selectedDateDisplay" class="text-gray-600 dark:text-gray-300">October 15, 2025</p>
                        </div>
                        <button id="nextDay" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors touch-friendly">
                            <i class="fas fa-chevron-right text-gray-600 dark:text-gray-300"></i>
                        </button>
                    </div>
                    <button id="todayBtn" class="mt-3 text-sm text-purple-600 dark:text-purple-400 font-medium hover:text-purple-800 dark:hover:text-purple-300 transition-colors touch-friendly-btn">
                        <i class="fas fa-calendar-day mr-1"></i> Go to Today
                    </button>
                </div>
            </div>

            <!-- Calendar View (Hidden by default) -->
            <div id="calendarView" class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 md:p-5 mb-6 hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-semibold text-gray-800 dark:text-white">Calendar</h2>
                    <div class="flex items-center space-x-2">
                        <button id="prevMonth" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors touch-friendly">
                            <i class="fas fa-chevron-left text-gray-600 dark:text-gray-300"></i>
                        </button>
                        <span id="currentMonth" class="font-medium text-gray-800 dark:text-white">October 2025</span>
                        <button id="nextMonth" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors touch-friendly">
                            <i class="fas fa-chevron-right text-gray-600 dark:text-gray-300"></i>
                        </button>
                    </div>
                </div>
                <div class="calendar-grid">
                    <div class="calendar-weekday">Sun</div>
                    <div class="calendar-weekday">Mon</div>
                    <div class="calendar-weekday">Tue</div>
                    <div class="calendar-weekday">Wed</div>
                    <div class="calendar-weekday">Thu</div>
                    <div class="calendar-weekday">Fri</div>
                    <div class="calendar-weekday">Sat</div>
                    <!-- Calendar days will be populated here -->
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 md:p-5 mb-6">
                <h2 class="text-lg font-semibold mb-3 text-gray-800 dark:text-white">Quick Actions</h2>
                <div class="quick-actions">
                    <button class="quick-action-btn touch-friendly-btn" id="quickCompleteAll">
                        <i class="fas fa-check-double"></i>
                        <span>Complete All</span>
                    </button>
                    <button class="quick-action-btn touch-friendly-btn" id="quickAddBreak">
                        <i class="fas fa-coffee"></i>
                        <span>Add Break</span>
                    </button>
                    <button class="quick-action-btn touch-friendly-btn" id="quickAddMeeting">
                        <i class="fas fa-users"></i>
                        <span>Add Meeting</span>
                    </button>
                    <button class="quick-action-btn touch-friendly-btn" id="quickAddExercise">
                        <i class="fas fa-running"></i>
                        <span>Add Exercise</span>
                    </button>
                    <button class="quick-action-btn touch-friendly-btn" id="quickAddReading">
                        <i class="fas fa-book"></i>
                        <span>Add Reading</span>
                    </button>
                    <button class="quick-action-btn touch-friendly-btn hidden md:flex" id="quickTimeBlock">
                        <i class="fas fa-clock"></i>
                        <span>Time Block</span>
                    </button>
                </div>
            </div>

            <!-- Main Content -->
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 main-grid">
                <!-- Task Input & Filters -->
                <div class="lg:col-span-3 space-y-6 task-section">
                    <!-- Task Input -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 md:p-5">
                        <h2 class="text-lg font-semibold mb-4 text-gray-800 dark:text-white">Add New Task</h2>
                        <div class="space-y-4">
                            <input type="text" id="newTaskInput" placeholder="What needs to be done?" 
                                   class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 dark:bg-gray-700 dark:text-white transition-colors task-input touch-friendly">
                            
                            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-3 task-input-grid">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Priority</label>
                                    <select id="prioritySelect" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 dark:bg-gray-700 dark:text-white transition-colors touch-friendly">
                                        <option value="low">Low</option>
                                        <option value="medium" selected>Medium</option>
                                        <option value="high">High</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Category</label>
                                    <select id="categorySelect" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 dark:bg-gray-700 dark:text-white transition-colors touch-friendly">
                                        <option value="personal">Personal</option>
                                        <option value="work" selected>Work</option>
                                        <option value="health">Health</option>
                                        <option value="learning">Learning</option>
                                        <option value="meetings">Meetings</option>
                                        <option value="breaks">Breaks</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Due Time</label>
                                    <input type="time" id="dueTimeInput" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 dark:bg-gray-700 dark:text-white transition-colors touch-friendly">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Duration (min)</label>
                                    <input type="number" id="durationInput" min="5" max="480" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 dark:bg-gray-700 dark:text-white transition-colors touch-friendly" placeholder="Optional">
                                </div>
                            </div>

                            <div class="flex items-center">
                                <input type="checkbox" id="recurringCheckbox" class="rounded text-purple-600 focus:ring-purple-500 touch-friendly">
                                <label for="recurringCheckbox" class="ml-2 text-sm text-gray-700 dark:text-gray-300">Make this a recurring task</label>
                            </div>
                            
                            <div id="recurringOptions" class="hidden grid grid-cols-1 sm:grid-cols-3 gap-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Repeat</label>
                                    <select id="repeatInterval" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 dark:bg-gray-700 dark:text-white transition-colors touch-friendly">
                                        <option value="daily">Daily</option>
                                        <option value="weekly">Weekly</option>
                                        <option value="monthly">Monthly</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Ends After</label>
                                    <input type="number" id="repeatCount" min="1" max="365" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 dark:bg-gray-700 dark:text-white transition-colors touch-friendly" placeholder="Occurrences">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Or On Date</label>
                                    <input type="date" id="repeatUntil" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 dark:bg-gray-700 dark:text-white transition-colors touch-friendly">
                                </div>
                            </div>

                            <!-- Task Estimation -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Effort Estimation</label>
                                <div class="flex items-center space-x-2">
                                    <button class="estimation-btn px-2 py-1 text-xs bg-gray-200 dark:bg-gray-700 rounded touch-friendly-btn" data-value="1">Easy</button>
                                    <button class="estimation-btn px-2 py-1 text-xs bg-gray-200 dark:bg-gray-700 rounded touch-friendly-btn" data-value="2">Medium</button>
                                    <button class="estimation-btn px-2 py-1 text-xs bg-gray-200 dark:bg-gray-700 rounded touch-friendly-btn" data-value="3">Hard</button>
                                    <button class="estimation-btn px-2 py-1 text-xs bg-gray-200 dark:bg-gray-700 rounded touch-friendly-btn" data-value="5">Complex</button>
                                </div>
                                <div class="estimation-bar mt-2">
                                    <div class="estimation-progress" id="estimationProgress" style="width: 0%"></div>
                                </div>
                            </div>
                            
                            <!-- Time Tracking -->
                            <div class="time-tracker hidden" id="timeTracker">
                                <div class="time-tracker-btn" id="startTimerBtn">
                                    <i class="fas fa-play"></i>
                                </div>
                                <div class="time-tracker-display" id="timeTrackerDisplay">00:00:00</div>
                                <div class="time-tracker-btn" id="stopTimerBtn">
                                    <i class="fas fa-stop"></i>
                                </div>
                            </div>
                            
                            <div class="flex justify-between">
                                <button id="addTaskButton" class="px-5 py-2.5 bg-purple-600 text-white font-medium rounded-lg shadow-md hover:bg-purple-700 transition-colors flex items-center touch-friendly-btn">
                                    <i class="fas fa-plus mr-2"></i> Add Task
                                </button>
                                
                                <div class="flex space-x-2">
                                    <button id="clearTasksButton" class="px-4 py-2.5 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 font-medium rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors touch-friendly-btn">
                                        Clear All
                                    </button>
                                    <button id="exportDataButton" class="px-4 py-2.5 bg-green-200 dark:bg-green-700 text-green-700 dark:text-green-300 font-medium rounded-lg hover:bg-green-300 dark:hover:bg-green-600 transition-colors touch-friendly-btn">
                                        Export
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Smart Suggestions -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 md:p-5" id="suggestionsSection">
                        <div class="flex justify-between items-center mb-3">
                            <h2 class="text-lg font-semibold text-gray-800 dark:text-white">Smart Suggestions</h2>
                            <button id="refreshSuggestions" class="text-gray-500 hover:text-purple-600 transition-colors touch-friendly">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                        <div id="suggestionsList" class="space-y-2">
                            <!-- Suggestions will be added here dynamically -->
                        </div>
                    </div>

                    <!-- Task Filters -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 md:p-5">
                        <div class="flex flex-wrap gap-2">
                            <button class="filter-btn active px-3 py-1.5 bg-purple-100 text-purple-700 rounded-full text-sm font-medium transition-colors touch-friendly-btn" data-filter="all">
                                All Tasks
                            </button>
                            <button class="filter-btn px-3 py-1.5 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-full text-sm font-medium hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors touch-friendly-btn" data-filter="active">
                                Active
                            </button>
                            <button class="filter-btn px-3 py-1.5 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-full text-sm font-medium hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors touch-friendly-btn" data-filter="completed">
                                Completed
                            </button>
                            <button class="filter-btn px-3 py-1.5 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-full text-sm font-medium hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors touch-friendly-btn" data-filter="high">
                                High Priority
                            </button>
                            <div class="relative flex-grow max-w-xs">
                                <input type="text" id="taskSearch" placeholder="Search tasks..." class="w-full px-3 py-1.5 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-full text-sm focus:ring-2 focus:ring-purple-500 focus:bg-white dark:focus:bg-gray-600 transition-colors touch-friendly">
                                <i class="fas fa-search absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Task List -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm overflow-hidden">
                        <div class="p-4 md:p-5 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                            <h2 class="text-lg font-semibold text-gray-800 dark:text-white">Today's Tasks</h2>
                            <div class="flex items-center space-x-2">
                                <span class="text-sm text-gray-500 dark:text-gray-400" id="taskCount">0 tasks</span>
                                <button id="sortTasksButton" class="p-1.5 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors touch-friendly" title="Sort tasks">
                                    <i class="fas fa-sort"></i>
                                </button>
                                <button id="viewModeButton" class="p-1.5 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors touch-friendly" title="Change view">
                                    <i class="fas fa-list"></i>
                                </button>
                            </div>
                        </div>
                        <div id="taskListContainer" class="p-4 md:p-5 space-y-4 max-h-96 overflow-y-auto custom-scrollbar">
                            <!-- Tasks will be injected here -->
                            <div class="empty-state">
                                <i class="fas fa-clipboard-list"></i>
                                <p>No tasks for today. Add one above!</p>
                                <button class="mt-4 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors touch-friendly-btn">
                                    <i class="fas fa-plus mr-2"></i> Add Your First Task
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Kanban Board (Hidden by default) -->
                    <div id="kanbanBoard" class="bg-white dark:bg-gray-800 rounded-xl shadow-sm overflow-hidden hidden">
                        <div class="p-4 md:p-5 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                            <h2 class="text-lg font-semibold text-gray-800 dark:text-white">Kanban Board</h2>
                            <button id="closeKanban" class="p-1.5 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors touch-friendly">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="p-4 md:p-5 grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="kanban-column">
                                <h3 class="text-gray-800 dark:text-white">To Do</h3>
                                <div id="todo-column" class="space-y-3 min-h-64 drop-zone">
                                    <!-- To Do tasks will be added here -->
                                    <div class="empty-state py-8">
                                        <i class="fas fa-inbox"></i>
                                        <p>No tasks to do</p>
                                    </div>
                                </div>
                            </div>
                            <div class="kanban-column">
                                <h3 class="text-gray-800 dark:text-white">In Progress</h3>
                                <div id="inprogress-column" class="space-y-3 min-h-64 drop-zone">
                                    <!-- In Progress tasks will be added here -->
                                    <div class="empty-state py-8">
                                        <i class="fas fa-cog"></i>
                                        <p>No tasks in progress</p>
                                    </div>
                                </div>
                            </div>
                            <div class="kanban-column">
                                <h3 class="text-gray-800 dark:text-white">Done</h3>
                                <div id="done-column" class="space-y-3 min-h-64 drop-zone">
                                    <!-- Done tasks will be added here -->
                                    <div class="empty-state py-8">
                                        <i class="fas fa-check-circle"></i>
                                        <p>No tasks completed</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sidebar -->
                <div class="space-y-6 sidebar">
                    <!-- Pomodoro Timer -->
                    <div class="pomodoro-timer">
                        <h2 class="text-lg font-semibold mb-4 text-gray-800 dark:text-white">Focus Timer</h2>
                        <div class="timer-display" id="timerDisplay">25:00</div>
                        <div class="timer-controls">
                            <button id="timerStart" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors touch-friendly-btn">
                                <i class="fas fa-play"></i>
                            </button>
                            <button id="timerPause" class="px-4 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 transition-colors touch-friendly-btn">
                                <i class="fas fa-pause"></i>
                            </button>
                            <button id="timerReset" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors touch-friendly-btn">
                                <i class="fas fa-stop"></i>
                            </button>
                        </div>
                        <div class="timer-progress">
                            <div class="timer-progress-bar" id="timerProgress"></div>
                        </div>
                        <div class="mt-4 flex justify-center space-x-2">
                            <button class="timer-preset px-3 py-1 text-sm bg-gray-200 dark:bg-gray-700 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors touch-friendly-btn" data-minutes="25">25min</button>
                            <button class="timer-preset px-3 py-1 text-sm bg-gray-200 dark:bg-gray-700 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors touch-friendly-btn" data-minutes="15">15min</button>
                            <button class="timer-preset px-3 py-1 text-sm bg-gray-200 dark:bg-gray-700 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors touch-friendly-btn" data-minutes="5">5min</button>
                        </div>
                        <div class="mt-4 text-center text-sm text-gray-600 dark:text-gray-400">
                            <span id="completedSessions">0</span> sessions completed today
                        </div>
                    </div>

                    <!-- Habit Tracker -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 md:p-5">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-lg font-semibold text-gray-800 dark:text-white">Habit Tracker</h2>
                            <button id="addHabit" class="text-purple-600 dark:text-purple-400 hover:text-purple-800 dark:hover:text-purple-300 transition-colors touch-friendly">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <div id="habitsList" class="space-y-3">
                            <!-- Habits will be added here dynamically -->
                            <div class="empty-state py-4">
                                <i class="fas fa-chart-line"></i>
                                <p>No habits tracked yet. Add one to build consistency!</p>
                                <button class="mt-2 px-3 py-1 bg-purple-600 text-white rounded-lg text-sm hover:bg-purple-700 transition-colors touch-friendly-btn">
                                    <i class="fas fa-plus mr-1"></i> Add Habit
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Categories -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 md:p-5">
                        <h2 class="text-lg font-semibold mb-4 text-gray-800 dark:text-white">Categories</h2>
                        <div class="space-y-3" id="categoriesList">
                            <!-- Categories will be dynamically updated -->
                        </div>
                    </div>

                    <!-- Daily Notes -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 md:p-5">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-lg font-semibold text-gray-800 dark:text-white">Daily Notes</h2>
                            <button id="saveNotesButton" class="text-purple-600 dark:text-purple-400 hover:text-purple-800 dark:hover:text-purple-300 transition-colors touch-friendly">
                                <i class="fas fa-save"></i>
                            </button>
                        </div>
                        <textarea id="dailyNotes" class="w-full h-32 p-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 dark:bg-gray-700 dark:text-white transition-colors touch-friendly" placeholder="Jot down your thoughts, ideas, or reminders..."></textarea>
                    </div>

                    <!-- Productivity Tip -->
                    <div class="bg-gradient-to-r from-blue-500 to-indigo-600 rounded-xl shadow-sm p-4 md:p-5 text-white">
                        <h2 class="text-lg font-semibold mb-2">Productivity Tip</h2>
                        <p class="text-blue-100 text-sm" id="productivityTip">Break large tasks into smaller, manageable steps to reduce overwhelm and increase completion rates.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Floating Action Button (Mobile) -->
        <div class="floating-action-btn non-essential md:hidden" id="fab">
            <i class="fas fa-plus text-xl"></i>
        </div>

        <!-- Mobile Bottom Navigation -->
        <div class="mobile-menu md:hidden" id="mobileMenu">
            <div class="mobile-menu-item active" data-section="tasks">
                <i class="fas fa-tasks"></i>
                <span>Tasks</span>
            </div>
            <div class="mobile-menu-item" data-section="timer">
                <i class="fas fa-clock"></i>
                <span>Timer</span>
            </div>
            <div class="mobile-menu-item" data-section="habits">
                <i class="fas fa-chart-line"></i>
                <span>Habits</span>
            </div>
            <div class="mobile-menu-item" data-section="notes">
                <i class="fas fa-sticky-note"></i>
                <span>Notes</span>
            </div>
            <div class="mobile-menu-item" data-section="calendar">
                <i class="fas fa-calendar"></i>
                <span>Calendar</span>
            </div>
        </div>

        <!-- Toast Notifications -->
        <div id="toastContainer"></div>

        <!-- Context Menu -->
        <div class="context-menu" id="contextMenu">
            <div class="context-menu-item" data-action="complete">Mark as Complete</div>
            <div class="context-menu-item" data-action="edit">Edit Task</div>
            <div class="context-menu-item" data-action="duplicate">Duplicate Task</div>
            <div class="context-menu-item" data-action="delete">Delete Task</div>
            <div class="context-menu-item" data-action="time">Track Time</div>
        </div>

        <!-- Settings Modal -->
        <div class="modal-overlay" id="settingsModal">
            <div class="modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Settings</h3>
                    <button id="closeSettingsModal" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 touch-friendly">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <h4 class="font-medium text-gray-700 dark:text-gray-300 mb-2">Appearance</h4>
                        <div class="flex items-center space-x-4">
                            <div class="flex items-center">
                                <input type="radio" id="themeSystem" name="theme" value="system" class="mr-2 touch-friendly">
                                <label for="themeSystem" class="text-gray-700 dark:text-gray-300">System</label>
                            </div>
                            <div class="flex items-center">
                                <input type="radio" id="themeLight" name="theme" value="light" class="mr-2 touch-friendly">
                                <label for="themeLight" class="text-gray-700 dark:text-gray-300">Light</label>
                            </div>
                            <div class="flex items-center">
                                <input type="radio" id="themeDark" name="theme" value="dark" class="mr-2 touch-friendly">
                                <label for="themeDark" class="text-gray-700 dark:text-gray-300">Dark</label>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="font-medium text-gray-700 dark:text-gray-300 mb-2">Notifications</h4>
                        <div class="flex items-center justify-between">
                            <span class="text-gray-700 dark:text-gray-300">Enable task reminders</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="enableNotifications" class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-purple-600"></div>
                            </label>
                        </div>
                    </div>

                    <div>
                        <h4 class="font-medium text-gray-700 dark:text-gray-300 mb-2">Focus Settings</h4>
                        <div class="space-y-2">
                            <div class="flex items-center justify-between">
                                <span class="text-gray-700 dark:text-gray-300">Auto-start breaks</span>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="autoBreak" class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-purple-600"></div>
                                </label>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-700 dark:text-gray-300">Focus sounds</span>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="focusSounds" class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-purple-600"></div>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="font-medium text-gray-700 dark:text-gray-300 mb-2">Data Management</h4>
                        <div class="space-y-2">
                            <button id="exportData" class="w-full text-left px-3 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors touch-friendly-btn">
                                Export All Data
                            </button>
                            <button id="importData" class="w-full text-left px-3 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors touch-friendly-btn">
                                Import Data
                            </button>
                            <button id="clearAllData" class="w-full text-left px-3 py-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded-lg hover:bg-red-200 dark:hover:bg-red-800 transition-colors touch-friendly-btn">
                                Clear All Data
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Confirmation Modal -->
        <div class="modal-overlay" id="confirmationModal">
            <div class="modal-content">
                <div class="text-center">
                    <i class="fas fa-exclamation-triangle text-yellow-500 text-4xl mb-4"></i>
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-2" id="confirmationTitle">Confirm Action</h3>
                    <p class="text-gray-600 dark:text-gray-400 mb-6" id="confirmationMessage">Are you sure you want to proceed?</p>
                    <div class="flex justify-center space-x-3">
                        <button id="confirmAction" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors touch-friendly-btn">
                            Confirm
                        </button>
                        <button id="cancelAction" class="px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-400 dark:hover:bg-gray-500 transition-colors touch-friendly-btn">
                            Cancel
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Habit Modal -->
        <div class="modal-overlay" id="habitModal">
            <div class="modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Add New Habit</h3>
                    <button id="closeHabitModal" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 touch-friendly">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Habit Name</label>
                        <input type="text" id="habitName" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 dark:bg-gray-700 dark:text-white transition-colors touch-friendly" placeholder="e.g., Morning Meditation">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Frequency</label>
                        <select id="habitFrequency" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 dark:bg-gray-700 dark:text-white transition-colors touch-friendly">
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="monthly">Monthly</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Goal</label>
                        <input type="number" id="habitGoal" min="1" max="100" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 dark:bg-gray-700 dark:text-white transition-colors touch-friendly" placeholder="e.g., 30 days" value="30">
                    </div>
                    
                    <div class="flex justify-end space-x-3">
                        <button id="cancelHabit" class="px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-400 dark:hover:bg-gray-500 transition-colors touch-friendly-btn">
                            Cancel
                        </button>
                        <button id="saveHabit" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors touch-friendly-btn">
                            Save Habit
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Enhanced application state with new features
        const state = {
            selectedDate: new Date(),
            tasks: JSON.parse(localStorage.getItem('tasks')) || [],
            currentFilter: 'all',
            isFocusMode: false,
            isDarkMode: localStorage.getItem('darkMode') === 'true',
            searchQuery: '',
            sortBy: 'priority',
            viewMode: 'list', // 'list' or 'kanban'
            calendarView: false,
            timer: {
                isRunning: false,
                timeLeft: 25 * 60, // 25 minutes in seconds
                totalTime: 25 * 60,
                interval: null,
                sessionsCompleted: 0
            },
            timeTracker: {
                isRunning: false,
                startTime: null,
                currentTaskId: null,
                interval: null
            },
            notes: localStorage.getItem('dailyNotes') || '',
            habits: JSON.parse(localStorage.getItem('habits')) || [],
            focusSessions: JSON.parse(localStorage.getItem('focusSessions')) || [],
            settings: JSON.parse(localStorage.getItem('appSettings')) || {
                theme: 'system',
                notifications: true,
                autoBreak: true,
                focusSounds: false
            },
            smartSuggestions: [
                "Break down large tasks into smaller steps",
                "Schedule your most important task for when you're most productive",
                "Take regular breaks to maintain focus",
                "Review your tasks at the end of each day",
                "Set clear priorities for the day",
                "Group similar tasks together",
                "Eliminate distractions during focus sessions",
                "Use the Pomodoro technique for better focus"
            ],
            // New features data
            calendar: {
                currentMonth: new Date().getMonth(),
                currentYear: new Date().getFullYear()
            },
            taskTemplates: [
                {
                    id: '1',
                    name: 'Morning Routine',
                    category: 'personal',
                    priority: 'medium',
                    duration: 60,
                    recurring: { interval: 'daily' }
                },
                {
                    id: '2',
                    name: 'Team Meeting',
                    category: 'meetings',
                    priority: 'medium',
                    duration: 60
                },
                {
                    id: '3',
                    name: 'Exercise Session',
                    category: 'health',
                    priority: 'medium',
                    duration: 45
                },
                {
                    id: '4',
                    name: 'Weekly Review',
                    category: 'work',
                    priority: 'high',
                    duration: 90,
                    recurring: { interval: 'weekly' }
                }
            ],
            collaborators: [
                { id: '1', name: 'Alex Johnson', initials: 'AJ' },
                { id: '2', name: 'Sam Wilson', initials: 'SW' },
                { id: '3', name: 'Taylor Kim', initials: 'TK' }
            ],
            timeEntries: JSON.parse(localStorage.getItem('timeEntries')) || [],
            notifications: JSON.parse(localStorage.getItem('notifications')) || []
        };

        // Motivational quotes and productivity tips
        const motivationalQuotes = [
            "The secret of getting ahead is getting started.",
            "Don't count the days, make the days count.",
            "It does not matter how slowly you go as long as you do not stop.",
            "The way to get started is to quit talking and begin doing.",
            "Your time is limited, so don't waste it living someone else's life.",
            "The future depends on what you do today.",
            "It's not whether you get knocked down, it's whether you get up.",
            "If you can dream it, you can do it.",
            "The only limit to our realization of tomorrow will be our doubts of today.",
            "You are never too old to set another goal or to dream a new dream."
        ];

        const productivityTips = [
            "Break large tasks into smaller, manageable steps to reduce overwhelm and increase completion rates.",
            "Use the Pomodoro Technique: work for 25 minutes, then take a 5-minute break.",
            "Prioritize your tasks using the Eisenhower Matrix: urgent vs. important.",
            "Limit distractions by turning off notifications during focused work sessions.",
            "Review your tasks at the end of each day and plan for the next day.",
            "Batch similar tasks together to improve efficiency and focus.",
            "Set specific, measurable, achievable, relevant, and time-bound (SMART) goals.",
            "Take regular breaks to maintain mental clarity and prevent burnout.",
            "Delegate tasks that others can do, freeing up time for high-priority work.",
            "Use the 2-minute rule: if a task takes less than 2 minutes, do it immediately."
        ];

        // Utility functions
        function formatDateForDB(date) {
            const y = date.getFullYear();
            const m = String(date.getMonth() + 1).padStart(2, '0');
            const d = String(date.getDate()).padStart(2, '0');
            return `${y}-${m}-${d}`;
        }

        function formatReadableDate(date) {
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        function getDayOfWeek(date) {
            const today = new Date();
            const tomorrow = new Date();
            tomorrow.setDate(today.getDate() + 1);

            const dbDate = formatDateForDB(date);
            const todayDb = formatDateForDB(today);
            const tomorrowDb = formatDateForDB(tomorrow);

            if (dbDate === todayDb) return 'Today';
            if (dbDate === tomorrowDb) return 'Tomorrow';

            return date.toLocaleDateString('en-US', { weekday: 'long' });
        }

        function getRandomQuote() {
            return motivationalQuotes[Math.floor(Math.random() * motivationalQuotes.length)];
        }

        function getRandomTip() {
            return productivityTips[Math.floor(Math.random() * productivityTips.length)];
        }

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;
            
            document.getElementById('toastContainer').appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('show');
            }, 10);
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    toast.remove();
                }, 300);
            }, 3000);
        }

        function updateProgress() {
            const totalTasks = state.tasks.length;
            const completedTasks = state.tasks.filter(task => task.completed).length;
            const progressPercent = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            
            // Update progress text
            document.getElementById('progressText').textContent = `${completedTasks}/${totalTasks} Tasks`;
            document.getElementById('progressPercent').textContent = `${progressPercent}%`;
            
            // Update progress circle
            const circle = document.getElementById('progressCircle');
            const radius = 28;
            const circumference = 2 * Math.PI * radius;
            const offset = circumference - (progressPercent / 100) * circumference;
            circle.style.strokeDasharray = `${circumference} ${circumference}`;
            circle.style.strokeDashoffset = offset;
            
            // Update motivational quote occasionally
            if (Math.random() < 0.1) {
                document.getElementById('motivationalQuote').textContent = `"${getRandomQuote()}"`;
            }
            
            // Update task count
            document.getElementById('taskCount').textContent = `${totalTasks} task${totalTasks !== 1 ? 's' : ''}`;
            
            // Update focus sessions count
            const todaySessions = state.focusSessions.filter(session => 
                session.date === formatDateForDB(new Date())
            ).length;
            document.getElementById('focusSessionsCount').textContent = todaySessions;
            document.getElementById('completedSessions').textContent = todaySessions;
            
            // Update focus visualization
            updateFocusVisualization();
            
            // Save tasks to localStorage
            localStorage.setItem('tasks', JSON.stringify(state.tasks));
        }

        function updateFocusVisualization() {
            const visualization = document.getElementById('focusVisualization');
            visualization.innerHTML = '';
            
            // Get today's focus sessions
            const todaySessions = state.focusSessions.filter(session => 
                session.date === formatDateForDB(new Date())
            );
            
            // Create blocks for each session
            todaySessions.forEach(session => {
                const block = document.createElement('div');
                block.className = 'focus-block';
                block.style.width = '10%';
                block.style.background = 'rgba(255,255,255,0.5)';
                visualization.appendChild(block);
            });
        }

        function updateCategoryCounts() {
            const categories = {
                work: { name: 'Work', color: 'bg-blue-500', count: 0 },
                personal: { name: 'Personal', color: 'bg-green-500', count: 0 },
                health: { name: 'Health', color: 'bg-red-500', count: 0 },
                learning: { name: 'Learning', color: 'bg-yellow-500', count: 0 },
                meetings: { name: 'Meetings', color: 'bg-indigo-500', count: 0 },
                breaks: { name: 'Breaks', color: 'bg-purple-500', count: 0 },
                other: { name: 'Other', color: 'bg-gray-500', count: 0 }
            };
            
            // Count tasks by category
            state.tasks.forEach(task => {
                if (categories[task.category]) {
                    categories[task.category].count++;
                }
            });
            
            // Update the categories list
            const categoriesList = document.getElementById('categoriesList');
            categoriesList.innerHTML = '';
            
            Object.values(categories).forEach(category => {
                const categoryElement = document.createElement('div');
                categoryElement.className = 'flex justify-between items-center p-2 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg transition-colors cursor-pointer';
                categoryElement.innerHTML = `
                    <div class="flex items-center">
                        <div class="w-3 h-3 rounded-full ${category.color} mr-3"></div>
                        <span class="text-gray-700 dark:text-gray-300">${category.name}</span>
                    </div>
                    <span class="bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300 text-xs font-medium px-2 py-1 rounded-full">${category.count}</span>
                `;
                
                categoryElement.addEventListener('click', () => {
                    // Filter tasks by this category
                    document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active', 'bg-purple-100', 'text-purple-700'));
                    state.currentFilter = 'all';
                    state.searchQuery = category.name.toLowerCase();
                    document.getElementById('taskSearch').value = category.name;
                    applyFilters();
                });
                
                categoriesList.appendChild(categoryElement);
            });
        }

        function applyFilters() {
            let filteredTasks = state.tasks;
            
            // Apply status filter
            switch(state.currentFilter) {
                case 'active':
                    filteredTasks = filteredTasks.filter(task => !task.completed);
                    break;
                case 'completed':
                    filteredTasks = filteredTasks.filter(task => task.completed);
                    break;
                case 'high':
                    filteredTasks = filteredTasks.filter(task => task.priority === 'high');
                    break;
            }
            
            // Apply search filter
            if (state.searchQuery) {
                const query = state.searchQuery.toLowerCase();
                filteredTasks = filteredTasks.filter(task => 
                    task.text.toLowerCase().includes(query) || 
                    task.category.toLowerCase().includes(query)
                );
            }
            
            // Apply sorting
            switch(state.sortBy) {
                case 'priority':
                    const priorityOrder = { high: 3, medium: 2, low: 1 };
                    filteredTasks.sort((a, b) => {
                        const aPriority = priorityOrder[a.priority] || 0;
                        const bPriority = priorityOrder[b.priority] || 0;
                        return bPriority - aPriority;
                    });
                    break;
                case 'time':
                    filteredTasks.sort((a, b) => {
                        if (!a.dueTime && !b.dueTime) return 0;
                        if (!a.dueTime) return 1;
                        if (!b.dueTime) return -1;
                        return a.dueTime.localeCompare(b.dueTime);
                    });
                    break;
                case 'category':
                    filteredTasks.sort((a, b) => a.category.localeCompare(b.category));
                    break;
            }
            
            if (state.viewMode === 'kanban') {
                renderKanbanBoard(filteredTasks);
            } else {
                renderTasks(filteredTasks);
            }
        }

        function renderTasks(tasksToRender) {
            const taskListContainer = document.getElementById('taskListContainer');
            
            if (tasksToRender.length === 0) {
                let message = "No tasks for today. Add one above!";
                if (state.currentFilter === 'active') message = "No active tasks. Great job!";
                if (state.currentFilter === 'completed') message = "No completed tasks yet.";
                if (state.currentFilter === 'high') message = "No high priority tasks.";
                if (state.searchQuery) message = "No tasks match your search.";
                
                taskListContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-clipboard-list"></i>
                        <p>${message}</p>
                        <button class="mt-4 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors touch-friendly-btn">
                            <i class="fas fa-plus mr-2"></i> Add Your First Task
                        </button>
                    </div>
                `;
                return;
            }

            taskListContainer.innerHTML = '';
            
            tasksToRender.forEach(task => {
                const taskItem = document.createElement('div');
                const isCompleted = task.completed;
                const priorityClass = `task-item ${task.priority}-priority ${isCompleted ? 'completed-task' : ''} p-4 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm relative overflow-hidden`;
                
                taskItem.className = priorityClass;
                taskItem.setAttribute('draggable', 'true');
                taskItem.setAttribute('data-task-id', task.id);
                
                if (state.isFocusMode && !isCompleted) {
                    taskItem.classList.add('focused-task');
                }
                
                // Check if task is overdue
                if (!isCompleted && task.dueTime) {
                    const now = new Date();
                    const [hours, minutes] = task.dueTime.split(':');
                    const taskTime = new Date();
                    taskTime.setHours(parseInt(hours), parseInt(minutes));
                    
                    if (taskTime < now) {
                        taskItem.classList.add('overdue');
                    }
                }
                
                // Format time if available
                let timeDisplay = '';
                if (task.dueTime) {
                    const [hours, minutes] = task.dueTime.split(':');
                    const time = new Date();
                    time.setHours(parseInt(hours), parseInt(minutes));
                    timeDisplay = time.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                }
                
                // Get category color
                const categoryColors = {
                    work: 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200',
                    personal: 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200',
                    health: 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200',
                    learning: 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200',
                    meetings: 'bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-200',
                    breaks: 'bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200',
                    other: 'bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200'
                };
                
                const categoryClass = categoryColors[task.category] || categoryColors.other;
                
                // Priority indicator
                const priorityIndicators = {
                    high: '<span class="priority-indicator priority-high"></span>',
                    medium: '<span class="priority-indicator priority-medium"></span>',
                    low: '<span class="priority-indicator priority-low"></span>'
                };
                
                // Swipe actions for mobile
                const swipeActions = `
                    <div class="task-swipe-actions">
                        <div class="swipe-action complete" data-task-id="${task.id}">
                            <i class="fas fa-check"></i>
                        </div>
                        <div class="swipe-action delete" data-task-id="${task.id}">
                            <i class="fas fa-trash"></i>
                        </div>
                    </div>
                `;
                
                taskItem.innerHTML = `
                    ${swipeActions}
                    <div class="flex items-start justify-between">
                        <div class="flex items-start space-x-3 flex-grow">
                            <button class="toggle-checkbox mt-1 flex-shrink-0 w-5 h-5 rounded-full border-2 ${isCompleted ? 'bg-purple-500 border-purple-500' : 'border-gray-300 dark:border-gray-600'} flex items-center justify-center transition-colors touch-friendly" data-task-id="${task.id}">
                                ${isCompleted ? '<i class="fas fa-check text-white text-xs"></i>' : ''}
                            </button>
                            <div class="flex-grow">
                                <p class="text-gray-800 dark:text-white ${isCompleted ? 'line-through text-gray-500 dark:text-gray-400' : ''}">${priorityIndicators[task.priority]} ${task.text}</p>
                                <div class="flex flex-wrap gap-2 mt-2">
                                    <span class="category-tag ${categoryClass}">${task.category}</span>
                                    ${timeDisplay ? `<span class="text-xs text-gray-500 dark:text-gray-400 flex items-center"><i class="far fa-clock mr-1"></i> ${timeDisplay}</span>` : ''}
                                    ${task.duration ? `<span class="text-xs text-gray-500 dark:text-gray-400 flex items-center"><i class="fas fa-hourglass-half mr-1"></i> ${task.duration}m</span>` : ''}
                                    ${task.recurring ? `<span class="text-xs text-gray-500 dark:text-gray-400 flex items-center"><i class="fas fa-redo mr-1"></i> ${task.recurring.interval}</span>` : ''}
                                    ${task.estimation ? `<span class="text-xs text-gray-500 dark:text-gray-400 flex items-center"><i class="fas fa-brain mr-1"></i> ${task.estimation}/5</span>` : ''}
                                    ${taskItem.classList.contains('overdue') ? `<span class="text-xs text-red-500 dark:text-red-400 flex items-center"><i class="fas fa-exclamation-triangle mr-1"></i> Overdue</span>` : ''}
                                </div>
                            </div>
                        </div>
                        <div class="flex space-x-2 ml-2">
                            <button class="text-gray-400 hover:text-purple-600 transition-colors edit-button touch-friendly" data-task-id="${task.id}" title="Edit Task">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="text-gray-400 hover:text-red-600 transition-colors delete-button touch-friendly" data-task-id="${task.id}" title="Delete Task">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
                taskListContainer.appendChild(taskItem);
            });

            // Attach event listeners after rendering
            attachTaskEventListeners();
            attachSwipeActions();
        }

        function renderKanbanBoard(tasksToRender) {
            const todoColumn = document.getElementById('todo-column');
            const inProgressColumn = document.getElementById('inprogress-column');
            const doneColumn = document.getElementById('done-column');
            
            // Clear columns
            todoColumn.innerHTML = '';
            inProgressColumn.innerHTML = '';
            doneColumn.innerHTML = '';
            
            if (tasksToRender.length === 0) {
                todoColumn.innerHTML = '<div class="empty-state py-8"><i class="fas fa-inbox"></i><p>No tasks to display</p></div>';
                return;
            }
            
            // Group tasks by status
            const todoTasks = tasksToRender.filter(task => !task.completed && !task.inProgress);
            const inProgressTasks = tasksToRender.filter(task => task.inProgress);
            const doneTasks = tasksToRender.filter(task => task.completed);
            
            // Render todo tasks
            if (todoTasks.length === 0) {
                todoColumn.innerHTML = '<div class="empty-state py-8"><i class="fas fa-inbox"></i><p>No tasks to do</p></div>';
            } else {
                todoTasks.forEach(task => {
                    const taskElement = createKanbanTaskElement(task);
                    todoColumn.appendChild(taskElement);
                });
            }
            
            // Render in progress tasks
            if (inProgressTasks.length === 0) {
                inProgressColumn.innerHTML = '<div class="empty-state py-8"><i class="fas fa-cog"></i><p>No tasks in progress</p></div>';
            } else {
                inProgressTasks.forEach(task => {
                    const taskElement = createKanbanTaskElement(task);
                    inProgressColumn.appendChild(taskElement);
                });
            }
            
            // Render done tasks
            if (doneTasks.length === 0) {
                doneColumn.innerHTML = '<div class="empty-state py-8"><i class="fas fa-check-circle"></i><p>No tasks completed</p></div>';
            } else {
                doneTasks.forEach(task => {
                    const taskElement = createKanbanTaskElement(task);
                    doneColumn.appendChild(taskElement);
                });
            }
            
            // Make columns droppable
            makeColumnsDroppable();
        }

        function createKanbanTaskElement(task) {
            const taskElement = document.createElement('div');
            taskElement.className = `kanban-task p-3 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm ${task.priority}-priority cursor-move`;
            taskElement.setAttribute('draggable', 'true');
            taskElement.setAttribute('data-task-id', task.id);
            
            // Get category color
            const categoryColors = {
                work: 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200',
                personal: 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200',
                health: 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200',
                learning: 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200',
                meetings: 'bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-200',
                breaks: 'bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200',
                other: 'bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200'
            };
            
            const categoryClass = categoryColors[task.category] || categoryColors.other;
            
            // Priority indicator
            const priorityIndicators = {
                high: '<span class="priority-indicator priority-high"></span>',
                medium: '<span class="priority-indicator priority-medium"></span>',
                low: '<span class="priority-indicator priority-low"></span>'
            };
            
            taskElement.innerHTML = `
                <p class="text-sm font-medium ${task.completed ? 'line-through text-gray-500' : 'text-gray-800 dark:text-white'}">${priorityIndicators[task.priority]} ${task.text}</p>
                <div class="flex flex-wrap gap-1 mt-2">
                    <span class="category-tag ${categoryClass} text-xs">${task.category}</span>
                    ${task.dueTime ? `<span class="text-xs text-gray-500 flex items-center"><i class="far fa-clock mr-1"></i> ${task.dueTime}</span>` : ''}
                </div>
                <div class="flex justify-between items-center mt-3">
                    <button class="toggle-kanban-checkbox text-gray-400 hover:text-green-500 transition-colors touch-friendly" data-task-id="${task.id}">
                        <i class="fas fa-${task.completed ? 'check-circle' : 'circle'}"></i>
                    </button>
                    <div class="flex space-x-1">
                        <button class="text-gray-400 hover:text-purple-600 transition-colors edit-button touch-friendly" data-task-id="${task.id}">
                            <i class="fas fa-edit text-xs"></i>
                        </button>
                        <button class="text-gray-400 hover:text-red-600 transition-colors delete-button touch-friendly" data-task-id="${task.id}">
                            <i class="fas fa-trash text-xs"></i>
                        </button>
                    </div>
                </div>
            `;
            
            return taskElement;
        }

        function makeColumnsDroppable() {
            const columns = document.querySelectorAll('.kanban-column > div');
            
            columns.forEach(column => {
                column.addEventListener('dragover', handleDragOver);
                column.addEventListener('drop', handleKanbanDrop);
            });
        }

        function handleKanbanDrop(e) {
            e.preventDefault();
            const taskId = e.dataTransfer.getData('text/plain');
            const task = state.tasks.find(t => t.id === taskId);
            const columnId = this.parentElement.id;
            
            if (task) {
                // Update task status based on column
                if (columnId === 'todo-column') {
                    task.completed = false;
                    task.inProgress = false;
                } else if (columnId === 'inprogress-column') {
                    task.inProgress = true;
                    task.completed = false;
                } else if (columnId === 'done-column') {
                    task.completed = true;
                    task.inProgress = false;
                }
                
                applyFilters();
                updateProgress();
                updateCategoryCounts();
                
                showToast('Task moved', 'success');
            }
        }

        function attachTaskEventListeners() {
            const taskListContainer = document.getElementById('taskListContainer');
            
            taskListContainer.querySelectorAll('.toggle-checkbox').forEach(checkbox => {
                checkbox.addEventListener('click', (e) => {
                    const taskId = e.currentTarget.dataset.taskId;
                    const task = state.tasks.find(t => t.id === taskId);
                    if (task) {
                        toggleTask(taskId, !task.completed);
                    }
                });
            });

            taskListContainer.querySelectorAll('.delete-button').forEach(button => {
                button.addEventListener('click', (e) => {
                    const taskId = e.currentTarget.dataset.taskId;
                    showConfirmation(
                        'Delete Task',
                        'Are you sure you want to delete this task? This action cannot be undone.',
                        () => deleteTask(taskId)
                    );
                });
            });

            taskListContainer.querySelectorAll('.edit-button').forEach(button => {
                button.addEventListener('click', (e) => {
                    const taskId = e.currentTarget.dataset.taskId;
                    editTask(taskId);
                });
            });

            // Context menu for tasks
            taskListContainer.querySelectorAll('.task-item').forEach(item => {
                item.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                    showContextMenu(e, item.dataset.taskId);
                });
            });

            // Drag and drop functionality
            taskListContainer.querySelectorAll('.task-item').forEach(item => {
                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragover', handleDragOver);
                item.addEventListener('dragenter', handleDragEnter);
                item.addEventListener('dragleave', handleDragLeave);
                item.addEventListener('drop', handleDrop);
                item.addEventListener('dragend', handleDragEnd);
            });
            
            // Kanban task event listeners
            document.querySelectorAll('.toggle-kanban-checkbox').forEach(checkbox => {
                checkbox.addEventListener('click', (e) => {
                    const taskId = e.currentTarget.dataset.taskId;
                    const task = state.tasks.find(t => t.id === taskId);
                    if (task) {
                        toggleTask(taskId, !task.completed);
                    }
                });
            });
            
            document.querySelectorAll('.kanban-task').forEach(task => {
                task.addEventListener('dragstart', handleDragStart);
            });
        }

        function attachSwipeActions() {
            const taskItems = document.querySelectorAll('.task-item');
            let startX, currentX, isSwiping = false;
            
            taskItems.forEach(item => {
                item.addEventListener('touchstart', (e) => {
                    startX = e.touches[0].clientX;
                    isSwiping = true;
                });
                
                item.addEventListener('touchmove', (e) => {
                    if (!isSwiping) return;
                    
                    currentX = e.touches[0].clientX;
                    const diff = startX - currentX;
                    
                    // Only allow right-to-left swipe
                    if (diff > 0) {
                        item.style.transform = `translateX(-${Math.min(diff, 120)}px)`;
                    }
                });
                
                item.addEventListener('touchend', (e) => {
                    if (!isSwiping) return;
                    
                    const diff = startX - currentX;
                    
                    if (diff > 60) {
                        // Swipe threshold reached - show actions
                        item.classList.add('swiped');
                        item.style.transform = 'translateX(-120px)';
                    } else {
                        // Reset position
                        item.style.transform = 'translateX(0)';
                    }
                    
                    isSwiping = false;
                });
                
                // Handle swipe action clicks
                item.querySelectorAll('.swipe-action').forEach(action => {
                    action.addEventListener('click', (e) => {
                        const taskId = action.dataset.taskId;
                        
                        if (action.classList.contains('complete')) {
                            const task = state.tasks.find(t => t.id === taskId);
                            if (task) {
                                toggleTask(taskId, !task.completed);
                            }
                        } else if (action.classList.contains('delete')) {
                            showConfirmation(
                                'Delete Task',
                                'Are you sure you want to delete this task? This action cannot be undone.',
                                () => deleteTask(taskId)
                            );
                        }
                        
                        // Reset swipe
                        item.classList.remove('swiped');
                        item.style.transform = 'translateX(0)';
                    });
                });
            });
        }

        // Context menu functions
        function showContextMenu(e, taskId) {
            const contextMenu = document.getElementById('contextMenu');
            contextMenu.style.left = `${e.pageX}px`;
            contextMenu.style.top = `${e.pageY}px`;
            contextMenu.classList.add('active');
            contextMenu.setAttribute('data-task-id', taskId);
            
            // Close context menu when clicking elsewhere
            document.addEventListener('click', closeContextMenu);
        }

        function closeContextMenu() {
            const contextMenu = document.getElementById('contextMenu');
            contextMenu.classList.remove('active');
            document.removeEventListener('click', closeContextMenu);
        }

        function setupContextMenuActions() {
            const contextMenu = document.getElementById('contextMenu');
            
            contextMenu.querySelectorAll('.context-menu-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    const taskId = contextMenu.getAttribute('data-task-id');
                    const action = e.target.getAttribute('data-action');
                    
                    switch(action) {
                        case 'complete':
                            const task = state.tasks.find(t => t.id === taskId);
                            if (task) {
                                toggleTask(taskId, !task.completed);
                            }
                            break;
                        case 'edit':
                            editTask(taskId);
                            break;
                        case 'duplicate':
                            duplicateTask(taskId);
                            break;
                        case 'delete':
                            showConfirmation(
                                'Delete Task',
                                'Are you sure you want to delete this task? This action cannot be undone.',
                                () => deleteTask(taskId)
                            );
                            break;
                        case 'time':
                            startTimeTracking(taskId);
                            break;
                    }
                    
                    closeContextMenu();
                });
            });
        }

        // Drag and drop functions
        let draggedItem = null;

        function handleDragStart(e) {
            draggedItem = this;
            this.classList.add('task-dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/plain', this.dataset.taskId);
        }

        function handleDragOver(e) {
            e.preventDefault();
            return false;
        }

        function handleDragEnter(e) {
            this.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            this.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.stopPropagation();
            if (draggedItem !== this) {
                // In a real app, you would update the task order in the database
                // For now, we'll just swap the elements in the DOM
                const taskListContainer = document.getElementById('taskListContainer');
                const allItems = Array.from(taskListContainer.querySelectorAll('.task-item'));
                const draggedIndex = allItems.indexOf(draggedItem);
                const targetIndex = allItems.indexOf(this);
                
                if (draggedIndex < targetIndex) {
                    taskListContainer.insertBefore(draggedItem, this.nextSibling);
                } else {
                    taskListContainer.insertBefore(draggedItem, this);
                }
                
                showToast('Task order updated', 'success');
            }
            this.classList.remove('drag-over');
            return false;
        }

        function handleDragEnd(e) {
            this.classList.remove('task-dragging');
            document.querySelectorAll('.task-item').forEach(item => {
                item.classList.remove('drag-over');
            });
        }

        function renderDateHeader() {
            document.getElementById('selectedDateDisplay').textContent = formatReadableDate(state.selectedDate);
            document.getElementById('dayOfWeek').textContent = getDayOfWeek(state.selectedDate);
        }

        // Timer functions
        function updateTimerDisplay() {
            const minutes = Math.floor(state.timer.timeLeft / 60);
            const seconds = state.timer.timeLeft % 60;
            document.getElementById('timerDisplay').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            const progressPercent = ((state.timer.totalTime - state.timer.timeLeft) / state.timer.totalTime) * 100;
            document.getElementById('timerProgress').style.width = `${progressPercent}%`;
        }

        function startTimer() {
            if (state.timer.isRunning) return;
            
            state.timer.isRunning = true;
            state.timer.interval = setInterval(() => {
                state.timer.timeLeft--;
                updateTimerDisplay();
                
                if (state.timer.timeLeft <= 0) {
                    clearInterval(state.timer.interval);
                    state.timer.isRunning = false;
                    
                    // Record focus session
                    const session = {
                        date: formatDateForDB(new Date()),
                        duration: state.timer.totalTime / 60, // in minutes
                        completedAt: new Date()
                    };
                    
                    state.focusSessions.push(session);
                    localStorage.setItem('focusSessions', JSON.stringify(state.focusSessions));
                    
                    state.timer.sessionsCompleted++;
                    updateProgress();
                    
                    showToast('Timer completed! Take a break.', 'success');
                    
                    // Play notification sound if enabled
                    if (state.settings.notifications) {
                        playNotificationSound();
                    }
                    
                    // Auto-start break if enabled
                    if (state.settings.autoBreak && state.timer.totalTime === 25 * 60) {
                        setTimeout(() => {
                            setTimer(5);
                            startTimer();
                            showToast('Break timer started', 'info');
                        }, 1000);
                    }
                }
            }, 1000);
        }

        function pauseTimer() {
            if (!state.timer.isRunning) return;
            
            clearInterval(state.timer.interval);
            state.timer.isRunning = false;
        }

        function resetTimer() {
            clearInterval(state.timer.interval);
            state.timer.isRunning = false;
            state.timer.timeLeft = state.timer.totalTime;
            updateTimerDisplay();
        }

        function setTimer(minutes) {
            state.timer.totalTime = minutes * 60;
            resetTimer();
        }

        function playNotificationSound() {
            // In a real app, you would play a sound file
            // For this demo, we'll use the browser's beep
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 1);
            } catch (e) {
                console.log('Audio context not supported');
            }
        }

        // Task management functions
        function addTask() {
            const input = document.getElementById('newTaskInput');
            const taskText = input.value.trim();
            const priority = document.getElementById('prioritySelect').value;
            const category = document.getElementById('categorySelect').value;
            const dueTime = document.getElementById('dueTimeInput').value;
            const duration = document.getElementById('durationInput').value;
            const isRecurring = document.getElementById('recurringCheckbox').checked;
            const repeatInterval = document.getElementById('repeatInterval').value;
            const repeatCount = document.getElementById('repeatCount').value;
            const repeatUntil = document.getElementById('repeatUntil').value;

            if (!taskText) {
                showToast('Please enter a task description', 'error');
                input.classList.add('shake-animation');
                setTimeout(() => input.classList.remove('shake-animation'), 500);
                return;
            }

            const newTask = {
                id: Date.now().toString(),
                text: taskText,
                date: formatDateForDB(state.selectedDate),
                completed: false,
                priority: priority,
                category: category,
                dueTime: dueTime || null,
                duration: duration || null,
                estimation: state.currentEstimation || null,
                createdAt: new Date(),
                recurring: isRecurring ? {
                    interval: repeatInterval,
                    count: repeatCount || null,
                    until: repeatUntil || null
                } : null
            };

            state.tasks.push(newTask);
            applyFilters();
            updateProgress();
            updateCategoryCounts();
            
            input.value = '';
            document.getElementById('dueTimeInput').value = '';
            document.getElementById('durationInput').value = '';
            document.getElementById('recurringCheckbox').checked = false;
            document.getElementById('recurringOptions').classList.add('hidden');
            document.getElementById('estimationProgress').style.width = '0%';
            state.currentEstimation = null;
            
            showToast('Task added successfully', 'success');
        }

        function toggleTask(taskId, isCompleted) {
            const taskIndex = state.tasks.findIndex(t => t.id === taskId);
            if (taskIndex !== -1) {
                state.tasks[taskIndex].completed = isCompleted;
                applyFilters();
                updateProgress();
                updateCategoryCounts();
                
                showToast(`Task marked as ${isCompleted ? 'completed' : 'active'}`, 'success');
            }
        }

        function deleteTask(taskId) {
            const taskIndex = state.tasks.findIndex(t => t.id === taskId);
            if (taskIndex !== -1) {
                state.tasks.splice(taskIndex, 1);
                applyFilters();
                updateProgress();
                updateCategoryCounts();
                
                showToast('Task deleted', 'success');
            }
        }

        function editTask(taskId) {
            const task = state.tasks.find(t => t.id === taskId);
            if (!task) return;
            
            // In a real app, you would show an edit form/modal
            // For this demo, we'll just allow inline editing of the task text
            const taskElement = document.querySelector(`[data-task-id="${taskId}"]`);
            const taskTextElement = taskElement.querySelector('p');
            const originalText = taskTextElement.textContent;
            
            const input = document.createElement('input');
            input.type = 'text';
            input.value = originalText.replace(/^[]\s/, ''); // Remove priority indicator
            input.className = 'w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 dark:bg-gray-700 dark:text-white';
            
            taskTextElement.replaceWith(input);
            input.focus();
            
            const saveEdit = () => {
                const newText = input.value.trim();
                if (newText && newText !== originalText.replace(/^[]\s/, '')) {
                    task.text = newText;
                    applyFilters();
                    showToast('Task updated', 'success');
                }
                
                // Restore the text element
                const newTextElement = document.createElement('p');
                newTextElement.className = `text-gray-800 dark:text-white ${task.completed ? 'line-through text-gray-500 dark:text-gray-400' : ''}`;
                
                // Add priority indicator back
                const priorityIndicators = {
                    high: ' ',
                    medium: ' ',
                    low: ' '
                };
                
                newTextElement.innerHTML = `${priorityIndicators[task.priority]}${newText || originalText.replace(/^[]\s/, '')}`;
                input.replaceWith(newTextElement);
            };
            
            input.addEventListener('blur', saveEdit);
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    saveEdit();
                }
            });
        }

        function duplicateTask(taskId) {
            const task = state.tasks.find(t => t.id === taskId);
            if (!task) return;
            
            const duplicatedTask = {
                ...task,
                id: Date.now().toString(),
                text: `${task.text} (Copy)`,
                createdAt: new Date()
            };
            
            state.tasks.push(duplicatedTask);
            applyFilters();
            updateProgress();
            updateCategoryCounts();
            
            showToast('Task duplicated', 'success');
        }

        function clearAllTasks() {
            if (state.tasks.length === 0) return;
            
            showConfirmation(
                'Clear All Tasks',
                `Are you sure you want to delete all ${state.tasks.length} tasks for ${formatReadableDate(state.selectedDate)}? This action cannot be undone.`,
                () => {
                    state.tasks = [];
                    applyFilters();
                    updateProgress();
                    updateCategoryCounts();
                    showToast('All tasks cleared', 'success');
                }
            );
        }

        function completeAllTasks() {
            if (state.tasks.length === 0) return;
            
            const activeTasks = state.tasks.filter(task => !task.completed);
            if (activeTasks.length === 0) {
                showToast('All tasks are already completed', 'info');
                return;
            }
            
            showConfirmation(
                'Complete All Tasks',
                `Are you sure you want to mark all ${activeTasks.length} active tasks as completed?`,
                () => {
                    state.tasks.forEach(task => {
                        task.completed = true;
                    });
                    applyFilters();
                    updateProgress();
                    updateCategoryCounts();
                    showToast('All tasks completed', 'success');
                }
            );
        }

        function addQuickTask(text, category, priority = 'medium', duration = null) {
            const newTask = {
                id: Date.now().toString(),
                text: text,
                date: formatDateForDB(state.selectedDate),
                completed: false,
                priority: priority,
                category: category,
                dueTime: null,
                duration: duration,
                createdAt: new Date()
            };

            state.tasks.push(newTask);
            applyFilters();
            updateProgress();
            updateCategoryCounts();
            
            showToast('Quick task added', 'success');
        }

        function changeDate(days) {
            state.selectedDate.setDate(state.selectedDate.getDate() + days);
            renderDateHeader();
            // In a real app, you would load tasks for the new date from the database
            applyFilters();
        }

        function goToToday() {
            state.selectedDate = new Date();
            renderDateHeader();
            // In a real app, you would load tasks for today from the database
            applyFilters();
        }

        function toggleDarkMode() {
            state.isDarkMode = !state.isDarkMode;
            document.body.classList.toggle('dark-mode', state.isDarkMode);
            localStorage.setItem('darkMode', state.isDarkMode);
            
            const themeIcon = document.querySelector('#themeToggle i');
            if (state.isDarkMode) {
                themeIcon.classList.remove('fa-moon');
                themeIcon.classList.add('fa-sun');
            } else {
                themeIcon.classList.remove('fa-sun');
                themeIcon.classList.add('fa-moon');
            }
        }

        function toggleFocusMode() {
            state.isFocusMode = !state.isFocusMode;
            document.getElementById('app').classList.toggle('focus-mode', state.isFocusMode);
            
            const focusButton = document.getElementById('focusModeToggle');
            if (state.isFocusMode) {
                focusButton.innerHTML = '<i class="fas fa-times mr-1"></i> <span class="hidden md:inline">Exit Focus</span>';
                focusButton.classList.remove('bg-purple-100', 'text-purple-700');
                focusButton.classList.add('bg-red-100', 'text-red-700');
            } else {
                focusButton.innerHTML = '<i class="fas fa-bullseye mr-1"></i> <span class="hidden md:inline">Focus</span>';
                focusButton.classList.remove('bg-red-100', 'text-red-700');
                focusButton.classList.add('bg-purple-100', 'text-purple-700');
            }
            
            applyFilters();
        }

        function toggleViewMode() {
            if (state.viewMode === 'list') {
                state.viewMode = 'kanban';
                document.getElementById('taskListContainer').parentElement.classList.add('hidden');
                document.getElementById('kanbanBoard').classList.remove('hidden');
                document.querySelector('#viewModeButton i').classList.remove('fa-list');
                document.querySelector('#viewModeButton i').classList.add('fa-columns');
                showToast('Switched to Kanban view', 'info');
            } else {
                state.viewMode = 'list';
                document.getElementById('taskListContainer').parentElement.classList.remove('hidden');
                document.getElementById('kanbanBoard').classList.add('hidden');
                document.querySelector('#viewModeButton i').classList.remove('fa-columns');
                document.querySelector('#viewModeButton i').classList.add('fa-list');
                showToast('Switched to List view', 'info');
            }
            
            applyFilters();
        }

        function showConfirmation(title, message, onConfirm) {
            document.getElementById('confirmationTitle').textContent = title;
            document.getElementById('confirmationMessage').textContent = message;
            document.getElementById('confirmationModal').classList.add('active');
            
            document.getElementById('confirmAction').onclick = () => {
                document.getElementById('confirmationModal').classList.remove('active');
                onConfirm();
            };
            
            document.getElementById('cancelAction').onclick = () => {
                document.getElementById('confirmationModal').classList.remove('active');
            };
        }

        function exportData() {
            const data = {
                tasks: state.tasks,
                notes: state.notes,
                habits: state.habits,
                focusSessions: state.focusSessions,
                settings: state.settings,
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const url = URL.createObjectURL(dataBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `daily-focus-backup-${formatDateForDB(new Date())}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast('Data exported successfully', 'success');
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const data = JSON.parse(event.target.result);
                        
                        if (data.tasks) state.tasks = data.tasks;
                        if (data.notes) {
                            state.notes = data.notes;
                            document.getElementById('dailyNotes').value = state.notes;
                        }
                        if (data.habits) state.habits = data.habits;
                        if (data.focusSessions) state.focusSessions = data.focusSessions;
                        if (data.settings) {
                            state.settings = data.settings;
                            localStorage.setItem('appSettings', JSON.stringify(state.settings));
                        }
                        
                        applyFilters();
                        updateProgress();
                        updateCategoryCounts();
                        renderHabits();
                        
                        showToast('Data imported successfully', 'success');
                    } catch (error) {
                        showToast('Error importing data: Invalid file format', 'error');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }

        function clearAllData() {
            showConfirmation(
                'Clear All Data',
                'Are you sure you want to delete ALL your data? This includes all tasks, notes, habits, and settings. This action cannot be undone.',
                () => {
                    state.tasks = [];
                    state.notes = '';
                    state.habits = [];
                    state.focusSessions = [];
                    state.settings = {
                        theme: 'system',
                        notifications: true,
                        autoBreak: true,
                        focusSounds: false
                    };
                    
                    localStorage.removeItem('tasks');
                    localStorage.removeItem('dailyNotes');
                    localStorage.removeItem('appSettings');
                    localStorage.removeItem('darkMode');
                    localStorage.removeItem('habits');
                    localStorage.removeItem('focusSessions');
                    
                    document.getElementById('dailyNotes').value = '';
                    applyFilters();
                    updateProgress();
                    updateCategoryCounts();
                    renderHabits();
                    
                    showToast('All data cleared', 'success');
                }
            );
        }

        // Habit tracker functions
        function renderHabits() {
            const habitsList = document.getElementById('habitsList');
            
            if (state.habits.length === 0) {
                habitsList.innerHTML = `
                    <div class="empty-state py-4">
                        <i class="fas fa-chart-line"></i>
                        <p>No habits tracked yet. Add one to build consistency!</p>
                        <button class="mt-2 px-3 py-1 bg-purple-600 text-white rounded-lg text-sm hover:bg-purple-700 transition-colors touch-friendly-btn">
                            <i class="fas fa-plus mr-1"></i> Add Habit
                        </button>
                    </div>
                `;
                return;
            }
            
            habitsList.innerHTML = '';
            
            state.habits.forEach(habit => {
                const habitElement = document.createElement('div');
                habitElement.className = 'habit-item p-3 border border-gray-200 dark:border-gray-700 rounded-lg';
                
                // Calculate completion rate
                const totalDays = habit.daysCompleted.length;
                const completionRate = Math.round((totalDays / habit.goal) * 100);
                
                // Calculate current streak
                const today = new Date();
                let streak = 0;
                let checkDate = new Date(today);
                
                while (true) {
                    const dateStr = formatDateForDB(checkDate);
                    if (habit.daysCompleted.includes(dateStr)) {
                        streak++;
                        checkDate.setDate(checkDate.getDate() - 1);
                    } else {
                        break;
                    }
                }
                
                habitElement.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <h3 class="font-medium text-gray-800 dark:text-white">${habit.name}</h3>
                        <div class="flex items-center space-x-2">
                            ${streak > 1 ? `<span class="streak-counter">${streak} day streak</span>` : ''}
                            <span class="text-xs bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200 px-2 py-1 rounded-full">${completionRate}%</span>
                        </div>
                    </div>
                    <div class="habit-grid mb-2">
                        ${Array.from({ length: 7 }, (_, i) => {
                            const date = new Date();
                            date.setDate(date.getDate() - (6 - i));
                            const dateStr = formatDateForDB(date);
                            const isCompleted = habit.daysCompleted.includes(dateStr);
                            const isToday = dateStr === formatDateForDB(new Date());
                            
                            return `
                                <div class="habit-day ${isCompleted ? 'completed' : isToday ? 'bg-gray-200 dark:bg-gray-700' : 'bg-gray-100 dark:bg-gray-800'} ${isToday ? 'border border-purple-500' : ''}" 
                                     data-habit-id="${habit.id}" data-date="${dateStr}">
                                    ${date.getDate()}
                                </div>
                            `;
                        }).join('')}
                    </div>
                    <div class="flex justify-between text-xs text-gray-500">
                        <span>${habit.frequency}</span>
                        <span>${totalDays}/${habit.goal} days</span>
                    </div>
                `;
                
                habitsList.appendChild(habitElement);
            });
            
            // Add event listeners to habit days
            document.querySelectorAll('.habit-day').forEach(day => {
                day.addEventListener('click', () => {
                    const habitId = day.dataset.habitId;
                    const date = day.dataset.date;
                    toggleHabitDay(habitId, date);
                });
            });
        }

        function toggleHabitDay(habitId, date) {
            const habit = state.habits.find(h => h.id === habitId);
            if (!habit) return;
            
            const dayIndex = habit.daysCompleted.indexOf(date);
            
            if (dayIndex === -1) {
                // Add day to completed
                habit.daysCompleted.push(date);
                showToast('Habit marked as completed', 'success');
            } else {
                // Remove day from completed
                habit.daysCompleted.splice(dayIndex, 1);
                showToast('Habit day removed', 'info');
            }
            
            localStorage.setItem('habits', JSON.stringify(state.habits));
            renderHabits();
        }

        function addHabit() {
            document.getElementById('habitModal').classList.add('active');
        }

        function saveHabit() {
            const name = document.getElementById('habitName').value.trim();
            const frequency = document.getElementById('habitFrequency').value;
            const goal = parseInt(document.getElementById('habitGoal').value);
            
            if (!name) {
                showToast('Please enter a habit name', 'error');
                return;
            }
            
            const newHabit = {
                id: Date.now().toString(),
                name: name,
                frequency: frequency,
                goal: goal,
                daysCompleted: [],
                createdAt: new Date()
            };
            
            state.habits.push(newHabit);
            localStorage.setItem('habits', JSON.stringify(state.habits));
            renderHabits();
            
            document.getElementById('habitModal').classList.remove('active');
            document.getElementById('habitName').value = '';
            document.getElementById('habitGoal').value = '30';
            
            showToast('Habit added successfully', 'success');
        }

        // Smart suggestions
        function renderSuggestions() {
            const suggestionsList = document.getElementById('suggestionsList');
            suggestionsList.innerHTML = '';
            
            // Show 3 random suggestions
            const shuffled = [...state.smartSuggestions].sort(() => 0.5 - Math.random());
            const selected = shuffled.slice(0, 3);
            
            selected.forEach(suggestion => {
                const suggestionElement = document.createElement('div');
                suggestionElement.className = 'suggestion-item';
                suggestionElement.innerHTML = `
                    <p class="text-sm text-gray-700 dark:text-gray-300">${suggestion}</p>
                `;
                
                suggestionElement.addEventListener('click', () => {
                    document.getElementById('newTaskInput').value = suggestion;
                    document.getElementById('newTaskInput').focus();
                    showToast('Suggestion applied to task input', 'info');
                });
                
                suggestionsList.appendChild(suggestionElement);
            });
        }

        // Mobile navigation
        function setupMobileNavigation() {
            const menuItems = document.querySelectorAll('.mobile-menu-item');
            
            menuItems.forEach(item => {
                item.addEventListener('click', () => {
                    // Remove active class from all items
                    menuItems.forEach(i => i.classList.remove('active'));
                    
                    // Add active class to clicked item
                    item.classList.add('active');
                    
                    // Scroll to section
                    const section = item.dataset.section;
                    let element;
                    
                    switch(section) {
                        case 'tasks':
                            element = document.querySelector('.task-section');
                            break;
                        case 'timer':
                            element = document.querySelector('.pomodoro-timer');
                            break;
                        case 'habits':
                            element = document.getElementById('habitsList').parentElement;
                            break;
                        case 'notes':
                            element = document.getElementById('dailyNotes').parentElement;
                            break;
                        case 'calendar':
                            toggleCalendarView();
                            return; // Don't scroll for calendar
                    }
                    
                    if (element) {
                        element.scrollIntoView({ behavior: 'smooth' });
                    }
                });
            });
        }

        // New feature: Calendar integration
        function renderCalendar() {
            const calendarGrid = document.querySelector('.calendar-grid');
            const currentMonthElement = document.getElementById('currentMonth');
            
            // Clear existing calendar days except weekdays
            const weekdays = calendarGrid.querySelectorAll('.calendar-weekday');
            calendarGrid.innerHTML = '';
            weekdays.forEach(weekday => calendarGrid.appendChild(weekday));
            
            // Set current month display
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'];
            currentMonthElement.textContent = `${monthNames[state.calendar.currentMonth]} ${state.calendar.currentYear}`;
            
            // Get first day of month and number of days
            const firstDay = new Date(state.calendar.currentYear, state.calendar.currentMonth, 1);
            const lastDay = new Date(state.calendar.currentYear, state.calendar.currentMonth + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDay = firstDay.getDay();
            
            // Add empty cells for days before the first day of the month
            for (let i = 0; i < startingDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day empty';
                calendarGrid.appendChild(emptyDay);
            }
            
            // Add days of the month
            const today = new Date();
            for (let i = 1; i <= daysInMonth; i++) {
                const day = document.createElement('div');
                day.className = 'calendar-day';
                day.textContent = i;
                
                // Check if this day has tasks
                const dateStr = `${state.calendar.currentYear}-${String(state.calendar.currentMonth + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
                const hasTasks = state.tasks.some(task => task.date === dateStr);
                
                if (hasTasks) {
                    day.classList.add('has-tasks');
                }
                
                // Check if this is today
                if (i === today.getDate() && 
                    state.calendar.currentMonth === today.getMonth() && 
                    state.calendar.currentYear === today.getFullYear()) {
                    day.classList.add('active');
                }
                
                // Add click event
                day.addEventListener('click', () => {
                    // Remove active class from all days
                    document.querySelectorAll('.calendar-day').forEach(d => d.classList.remove('active'));
                    // Add active class to clicked day
                    day.classList.add('active');
                    
                    // Update selected date
                    state.selectedDate = new Date(state.calendar.currentYear, state.calendar.currentMonth, i);
                    renderDateHeader();
                    applyFilters();
                    
                    // Hide calendar and show task list
                    toggleCalendarView();
                });
                
                calendarGrid.appendChild(day);
            }
        }

        function toggleCalendarView() {
            state.calendarView = !state.calendarView;
            
            if (state.calendarView) {
                document.getElementById('calendarView').classList.remove('hidden');
                document.querySelector('.task-section').classList.add('hidden');
                renderCalendar();
            } else {
                document.getElementById('calendarView').classList.add('hidden');
                document.querySelector('.task-section').classList.remove('hidden');
            }
        }

        function changeCalendarMonth(direction) {
            if (direction === 'next') {
                state.calendar.currentMonth++;
                if (state.calendar.currentMonth > 11) {
                    state.calendar.currentMonth = 0;
                    state.calendar.currentYear++;
                }
            } else {
                state.calendar.currentMonth--;
                if (state.calendar.currentMonth < 0) {
                    state.calendar.currentMonth = 11;
                    state.calendar.currentYear--;
                }
            }
            
            renderCalendar();
        }

        // New feature: Time tracking
        function startTimeTracking(taskId) {
            if (state.timeTracker.isRunning) {
                stopTimeTracking();
            }
            
            state.timeTracker.isRunning = true;
            state.timeTracker.startTime = new Date();
            state.timeTracker.currentTaskId = taskId;
            
            // Show time tracker
            document.getElementById('timeTracker').classList.remove('hidden');
            
            // Update display every second
            state.timeTracker.interval = setInterval(updateTimeTrackerDisplay, 1000);
            
            showToast('Time tracking started', 'success');
        }

        function stopTimeTracking() {
            if (!state.timeTracker.isRunning) return;
            
            state.timeTracker.isRunning = false;
            const endTime = new Date();
            const duration = Math.floor((endTime - state.timeTracker.startTime) / 1000); // in seconds
            
            // Save time entry
            const timeEntry = {
                taskId: state.timeTracker.currentTaskId,
                startTime: state.timeTracker.startTime,
                endTime: endTime,
                duration: duration
            };
            
            state.timeEntries.push(timeEntry);
            localStorage.setItem('timeEntries', JSON.stringify(state.timeEntries));
            
            // Hide time tracker
            document.getElementById('timeTracker').classList.add('hidden');
            
            // Clear interval
            clearInterval(state.timeTracker.interval);
            
            // Reset display
            document.getElementById('timeTrackerDisplay').textContent = '00:00:00';
            
            showToast(`Time tracked: ${formatTime(duration)}`, 'success');
        }

        function updateTimeTrackerDisplay() {
            if (!state.timeTracker.isRunning) return;
            
            const now = new Date();
            const duration = Math.floor((now - state.timeTracker.startTime) / 1000); // in seconds
            document.getElementById('timeTrackerDisplay').textContent = formatTime(duration);
        }

        function formatTime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            
            return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }

        // Enhanced mobile responsiveness
        function enhanceMobileResponsiveness() {
            // Make buttons more touch-friendly
            document.querySelectorAll('button, select, input[type="checkbox"]').forEach(element => {
                if (!element.classList.contains('touch-friendly') && !element.classList.contains('touch-friendly-btn')) {
                    if (element.tagName === 'BUTTON') {
                        element.classList.add('touch-friendly-btn');
                    } else {
                        element.classList.add('touch-friendly');
                    }
                }
            });
            
            // Improve task item touch interactions
            document.addEventListener('touchstart', function() {}, { passive: true });
            
            // Adjust layout for mobile
            if (window.innerWidth < 768) {
                // Stack elements vertically
                document.querySelectorAll('.flex-row').forEach(el => {
                    if (el.classList.contains('md:flex-row')) return;
                    el.classList.add('flex-col');
                    el.classList.remove('flex-row');
                });
                
                // Adjust padding and margins
                document.querySelectorAll('.p-4, .p-5, .p-6').forEach(el => {
                    const currentPadding = parseInt(getComputedStyle(el).padding);
                    if (currentPadding > 16) {
                        el.style.padding = '16px';
                    }
                });
            }
        }

        // Initialize the application with new features
        function init() {
            // Set up event listeners
            document.getElementById('addTaskButton').addEventListener('click', addTask);
            document.getElementById('newTaskInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    addTask();
                }
            });

            document.getElementById('prevDay').addEventListener('click', () => changeDate(-1));
            document.getElementById('nextDay').addEventListener('click', () => changeDate(1));
            document.getElementById('todayBtn').addEventListener('click', goToToday);
            document.getElementById('clearTasksButton').addEventListener('click', clearAllTasks);
            document.getElementById('exportDataButton').addEventListener('click', exportData);
            
            // Theme toggle
            document.getElementById('themeToggle').addEventListener('click', toggleDarkMode);
            
            // Focus mode toggle
            document.getElementById('focusModeToggle').addEventListener('click', toggleFocusMode);
            
            // View mode toggle
            document.getElementById('viewModeButton').addEventListener('click', toggleViewMode);
            document.getElementById('viewToggle').addEventListener('click', toggleViewMode);
            document.getElementById('closeKanban').addEventListener('click', toggleViewMode);
            
            // Calendar toggle
            document.getElementById('calendarToggle').addEventListener('click', toggleCalendarView);
            document.getElementById('prevMonth').addEventListener('click', () => changeCalendarMonth('prev'));
            document.getElementById('nextMonth').addEventListener('click', () => changeCalendarMonth('next'));
            
            // Settings modal
            document.getElementById('settingsToggle').addEventListener('click', () => {
                document.getElementById('settingsModal').classList.add('active');
            });
            
            document.getElementById('closeSettingsModal').addEventListener('click', () => {
                document.getElementById('settingsModal').classList.remove('active');
            });
            
            // Settings actions
            document.getElementById('exportData').addEventListener('click', exportData);
            document.getElementById('importData').addEventListener('click', importData);
            document.getElementById('clearAllData').addEventListener('click', clearAllData);
            
            // Filter buttons
            document.querySelectorAll('.filter-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    // Remove active class from all buttons
                    document.querySelectorAll('.filter-btn').forEach(btn => {
                        btn.classList.remove('active', 'bg-purple-100', 'text-purple-700');
                        btn.classList.add('bg-gray-100', 'text-gray-700', 'dark:bg-gray-700', 'dark:text-gray-300');
                    });
                    
                    // Add active class to clicked button
                    e.target.classList.add('active', 'bg-purple-100', 'text-purple-700');
                    e.target.classList.remove('bg-gray-100', 'text-gray-700', 'dark:bg-gray-700', 'dark:text-gray-300');
                    
                    // Update current filter and apply it
                    state.currentFilter = e.target.dataset.filter;
                    applyFilters();
                });
            });
            
            // Search functionality
            document.getElementById('taskSearch').addEventListener('input', (e) => {
                state.searchQuery = e.target.value;
                applyFilters();
            });
            
            // Sort functionality
            document.getElementById('sortTasksButton').addEventListener('click', () => {
                // Cycle through sort options
                const sortOptions = ['priority', 'time', 'category'];
                const currentIndex = sortOptions.indexOf(state.sortBy);
                state.sortBy = sortOptions[(currentIndex + 1) % sortOptions.length];
                
                applyFilters();
                showToast(`Sorted by ${state.sortBy}`, 'info');
            });
            
            // Floating action button for mobile
            document.getElementById('fab').addEventListener('click', () => {
                document.getElementById('newTaskInput').focus();
            });
            
            // Timer controls
            document.getElementById('timerStart').addEventListener('click', startTimer);
            document.getElementById('timerPause').addEventListener('click', pauseTimer);
            document.getElementById('timerReset').addEventListener('click', resetTimer);
            
            // Timer presets
            document.querySelectorAll('.timer-preset').forEach(button => {
                button.addEventListener('click', (e) => {
                    const minutes = parseInt(e.target.dataset.minutes);
                    setTimer(minutes);
                    showToast(`Timer set to ${minutes} minutes`, 'info');
                });
            });
            
            // Quick actions
            document.getElementById('quickCompleteAll').addEventListener('click', completeAllTasks);
            document.getElementById('quickAddBreak').addEventListener('click', () => {
                addQuickTask('Take a break', 'breaks', 'low', 15);
            });
            document.getElementById('quickAddMeeting').addEventListener('click', () => {
                addQuickTask('Team meeting', 'meetings', 'medium', 60);
            });
            document.getElementById('quickAddExercise').addEventListener('click', () => {
                addQuickTask('Exercise session', 'health', 'medium', 30);
            });
            document.getElementById('quickAddReading').addEventListener('click', () => {
                addQuickTask('Reading time', 'learning', 'low', 45);
            });
            document.getElementById('quickTimeBlock').addEventListener('click', () => {
                addQuickTask('Time blocking session', 'work', 'medium', 60);
            });
            
            // Notes functionality
            document.getElementById('dailyNotes').value = state.notes;
            document.getElementById('saveNotesButton').addEventListener('click', () => {
                state.notes = document.getElementById('dailyNotes').value;
                localStorage.setItem('dailyNotes', state.notes);
                showToast('Notes saved', 'success');
            });
            
            // Recurring task options
            document.getElementById('recurringCheckbox').addEventListener('change', (e) => {
                document.getElementById('recurringOptions').classList.toggle('hidden', !e.target.checked);
            });
            
            // Task estimation
            document.querySelectorAll('.estimation-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const value = parseInt(e.target.dataset.value);
                    state.currentEstimation = value;
                    document.getElementById('estimationProgress').style.width = `${(value / 5) * 100}%`;
                    
                    // Update button states
                    document.querySelectorAll('.estimation-btn').forEach(btn => {
                        btn.classList.remove('bg-purple-500', 'text-white');
                    });
                    e.target.classList.add('bg-purple-500', 'text-white');
                });
            });
            
            // Habit functionality
            document.getElementById('addHabit').addEventListener('click', addHabit);
            document.getElementById('saveHabit').addEventListener('click', saveHabit);
            document.getElementById('cancelHabit').addEventListener('click', () => {
                document.getElementById('habitModal').classList.remove('active');
            });
            document.getElementById('closeHabitModal').addEventListener('click', () => {
                document.getElementById('habitModal').classList.remove('active');
            });
            
            // Smart suggestions
            document.getElementById('refreshSuggestions').addEventListener('click', renderSuggestions);
            
            // Context menu
            setupContextMenuActions();
            
            // Time tracking
            document.getElementById('startTimerBtn').addEventListener('click', () => {
                // This would typically be called from a specific task
                // For demo, we'll use the first task if available
                if (state.tasks.length > 0) {
                    startTimeTracking(state.tasks[0].id);
                } else {
                    showToast('No tasks available to track time for', 'error');
                }
            });
            
            document.getElementById('stopTimerBtn').addEventListener('click', stopTimeTracking);
            
            // Initialize UI
            renderDateHeader();
            updateTimerDisplay();
            document.getElementById('productivityTip').textContent = getRandomTip();
            renderHabits();
            renderSuggestions();
            setupMobileNavigation();
            
            // Show mobile menu
            document.getElementById('mobileMenu').classList.add('active');
            
            // Apply dark mode if enabled
            if (state.isDarkMode) {
                document.body.classList.add('dark-mode');
                const themeIcon = document.querySelector('#themeToggle i');
                themeIcon.classList.remove('fa-moon');
                themeIcon.classList.add('fa-sun');
            }
            
            // Enhance mobile responsiveness
            enhanceMobileResponsiveness();
            window.addEventListener('resize', enhanceMobileResponsiveness);
            
            // Add some sample tasks for demonstration
            if (state.tasks.length === 0) {
                state.tasks = [
                    {
                        id: '1',
                        text: 'Complete project proposal',
                        date: formatDateForDB(state.selectedDate),
                        completed: false,
                        priority: 'high',
                        category: 'work',
                        dueTime: '14:00',
                        duration: 120,
                        estimation: 3,
                        createdAt: new Date()
                    },
                    {
                        id: '2',
                        text: 'Morning meditation',
                        date: formatDateForDB(state.selectedDate),
                        completed: true,
                        priority: 'medium',
                        category: 'health',
                        dueTime: '08:00',
                        duration: 15,
                        createdAt: new Date()
                    },
                    {
                        id: '3',
                        text: 'Read industry news',
                        date: formatDateForDB(state.selectedDate),
                        completed: false,
                        priority: 'low',
                        category: 'learning',
                        dueTime: null,
                        duration: 30,
                        createdAt: new Date()
                    }
                ];
                
                applyFilters();
                updateProgress();
                updateCategoryCounts();
            }
            
            // Add sample habits for demonstration
            if (state.habits.length === 0) {
                const today = new Date();
                const yesterday = new Date();
                yesterday.setDate(today.getDate() - 1);
                
                state.habits = [
                    {
                        id: '1',
                        name: 'Morning Meditation',
                        frequency: 'daily',
                        goal: 30,
                        daysCompleted: [
                            formatDateForDB(yesterday),
                            formatDateForDB(today)
                        ],
                        createdAt: new Date()
                    },
                    {
                        id: '2',
                        name: 'Evening Journal',
                        frequency: 'daily',
                        goal: 30,
                        daysCompleted: [
                            formatDateForDB(yesterday)
                        ],
                        createdAt: new Date()
                    }
                ];
                
                renderHabits();
            }
        }

        // Start the application when the DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>